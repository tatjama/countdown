<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Countdown Widget</title>
<style>
  body {
    margin: 0; 
    font-family: "Arial", sans-serif;
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: center; 
    min-height: 100vh; 
    transition: background-color 0.3s, color 0.3s;
  }
  .countdown {
    display: flex;
    gap: 10px;
    font-weight: bold;
    text-align: center;
  }
  .unit {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 2rem;
  }
  .label {
    font-size: 0.7rem;
    opacity: 0.7;
  }
  .settings {
    position: fixed;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 10px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    gap: 5px;
    font-size: 0.9rem;
  }
  input, select, button {
    padding: 5px;
    border-radius: 4px;
    border: 1px solid #aaa;
  }
  button {
    cursor: pointer;
    background-color: #007bff;
    color: white;
    border: none;
  }
  button:hover { background-color: #0056b3; }
  .iframe-code {
    margin-top: 15px;
    font-size: 0.8rem;
    word-break: break-all;
    background: #f0f0f0;
    padding: 5px;
    border-radius: 4px;
  }
</style>
</head>
<body>

<h1 id="title"></h1>

<div class="countdown" id="countdown">
  <div class="unit"><span id="days">00</span><span class="label">Days</span></div>
  <div class="unit"><span id="hours">00</span><span class="label">Hours</span></div>
  <div class="unit"><span id="minutes">00</span><span class="label">Minutes</span></div>
  <div class="unit"><span id="seconds">00</span><span class="label">Seconds</span></div>
</div>

<div class="settings" id="settings">
  <label>Title: <input type="text" id="inputTitle"></label>
  <label>Date: <input type="date" id="inputDate"></label>
  <label>Time: <input type="time" id="inputTime"></label>
  <label>Theme:
    <select id="inputTheme">
      <option value="dark">Dark</option>
      <option value="light">Light</option>
      <option value="transparent">Transparent</option>
    </select>
  </label>
  <button id="applyBtn">Apply & Generate Iframe</button>
  <div class="iframe-code" id="iframeCode"></div>
</div>

<script>
  // ======== Initialization ========
  const urlParams = new URLSearchParams(window.location.search);
  const isEmbed = urlParams.get('embed') === 'true';

  // Elements
  const titleEl = document.getElementById('title');
  const daysEl = document.getElementById('days');
  const hoursEl = document.getElementById('hours');
  const minutesEl = document.getElementById('minutes');
  const secondsEl = document.getElementById('seconds');
  const settingsEl = document.getElementById('settings');
  const iframeCodeEl = document.getElementById('iframeCode');

  const inputTitle = document.getElementById('inputTitle');
  const inputDate = document.getElementById('inputDate');
  const inputTime = document.getElementById('inputTime');
  const inputTheme = document.getElementById('inputTheme');
  const applyBtn = document.getElementById('applyBtn');

  if (isEmbed) {
    settingsEl.style.display = 'none';
  }

  // ======== State from URL or default ========
  let title = urlParams.get('title') || 'Project Launch';
  let targetDateParam = urlParams.get('date');
  let theme = urlParams.get('theme') || 'dark';

  let targetDate = targetDateParam ? new Date(targetDateParam) : new Date(Date.now() + 24*60*60*1000);

  titleEl.textContent = title;
  document.body.style.backgroundColor = theme==='dark'? '#000' : theme==='light'? '#fff' : 'transparent';
  document.body.style.color = theme==='dark'? '#fff' : theme==='light'? '#000' : '#000';

  inputTitle.value = title;
  inputDate.value = targetDate.toISOString().split('T')[0];
  inputTime.value = targetDate.toTimeString().slice(0,5);
  inputTheme.value = theme;

  // ======== Countdown Logic ========
  function updateCountdown() {
    const now = new Date().getTime();
    let diff = targetDate.getTime() - now;
    if (diff < 0) diff = 0;

    const d = Math.floor(diff / (1000*60*60*24));
    const h = Math.floor((diff / (1000*60*60)) % 24);
    const m = Math.floor((diff / (1000*60)) % 60);
    const s = Math.floor((diff / 1000) % 60);

    daysEl.textContent = String(d).padStart(2,'0');
    hoursEl.textContent = String(h).padStart(2,'0');
    minutesEl.textContent = String(m).padStart(2,'0');
    secondsEl.textContent = String(s).padStart(2,'0');
  }

  updateCountdown();
  setInterval(updateCountdown, 1000);

  // ======== Apply & Generate iframe ========
  applyBtn.addEventListener('click', () => {
    title = inputTitle.value;
    const dateStr = inputDate.value;
    const timeStr = inputTime.value;
    theme = inputTheme.value;

    targetDate = new Date(`${dateStr}T${timeStr}`);

    // Update DOM
    titleEl.textContent = title;
    document.body.style.backgroundColor = theme==='dark'? '#000' : theme==='light'? '#fff' : 'transparent';
    document.body.style.color = theme==='dark'? '#fff' : theme==='light'? '#000' : '#000';

    // Update URL
    const newUrl = new URL(window.location.href);
    newUrl.searchParams.set('title', title);
    newUrl.searchParams.set('date', targetDate.toISOString());
    newUrl.searchParams.set('theme', theme);
    newUrl.searchParams.set('embed', true);
    window.history.replaceState({}, '', newUrl);

    // Generate iframe code
    iframeCodeEl.textContent = `<iframe src="${newUrl}" width="100%" height="400px" style="border:none;border-radius:12px;"></iframe>`;
  });

</script>

</body>
</html>